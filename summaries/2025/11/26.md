# Activity Summary for 11/26/2025

## 12:26:53 AM
The provided log details changes across the `Integrity Handler` Go application, focusing on filesystem encryption and integrity management.

**File-Specific Updates:**

*   **`/Users/cnesbitt/shared/ssr/go/bin/IntegrityHandler/common/directories.go`**
    *   **Initial state (11/21/2025, 2:26:50 PM):** This file defines constant strings for critical directory paths used by the Integrity Handler, including `/boot/integrity` (for handler files and encrypted FEMK), `/opt/128technology/integrity/.migration-store` (for migration data), `/opt/128technology/integrity/migration-recovery` (for recovery data), and `/opt/128technology/integrity/manifest.d` (for manifest files).
    *   **Update (11/21/2025, 4:02:40 PM):** A minor change occurred, updating the package-level comment to clarify its purpose as containing "common globals used throughout Integrity Handler." The constant directory paths themselves remained unchanged.

*   **`/Users/cnesbitt/shared/ssr/go/bin/IntegrityHandler/integrity.go`**
    *   **Initial state (11/21/2025, 2:27:15 PM):** This file contains the core logic for the Integrity Handler application. It includes functions to:
        *   `verifyAndInitializeEnvironment`: Check system prerequisites (root user, kernel version >= 5.4, filesystem encryption support, `fscrypt` command availability) and initialize TPM/vTPM.
        *   `enableIntegrity`: Orchestrates the encryption process, ensuring necessary directories exist, resolving the File Encryption Master Key (FEMK), setting up `fscrypt`, and initiating directory encryption.
        *   `unlockEncryptedDirs`: Unlocks previously encrypted directories.
        *   `getFsKey`: Manages the secure retrieval and storage of the filesystem key using a `vault.SecureContainer`.
        *   `ensureDirectoriesExist`: Creates and cleans the various directories defined in `common`.
        *   `handleRecoveryDirectoryWarnings`: Checks for contents in the recovery directory, logging warnings if found.
    *   **Subsequent timestamps (11/21/2025, 2:27:22 PM; 11/21/2025, 2:28:49 PM; 11/21/2025, 2:40:35 PM):** The code content for this file remained functionally identical across these three timestamps, indicating no code changes were made, likely just re-saves or minor non-code modifications.

*   **`/Users/cnesbitt/shared/ssr/go/bin/IntegrityHandler/main.go`**
    *   **Initial state (11/21/2025, 4:00:45 PM):** This is the application's entry point. It sets up logging, parses a `mountPath` command-line argument, and defines custom `ExitCode` values (Success, Failure, Incompatible, Compromised). The `run` function coordinates the application's flow, calling `handleRecoveryDirectoryWarnings`, `verifyAndInitializeEnvironment`, `enableIntegrity`, and `unlockEncryptedDirs`, with comprehensive error handling that maps failures to specific `ExitCode`s. It also embeds and retrieves a version string.

*   **`/Users/cnesbitt/shared/ssr/go/bin/IntegrityHandler/fscrypt/fscrypt.go`**
    *   **Initial state (11/21/2025, 4:11:30 PM):** This file provides high-level wrappers for `fscrypt` operations. It defined various error constants related to encryption and file operations, implemented `SetupOnMount` for global and filesystem-specific `fscrypt` setup, and introduced the `EncryptionResult` struct to detail the outcomes of encryption attempts (successes, already encrypted, and various failure types including relocation, encryption, unlock, restore, and recover failures). The `EncryptTargetDirs` function orchestrated the encryption of multiple directories, using `encryptTargetDir` to handle the relocation of contents, creation of empty encrypted directories, and subsequent restoration of contents.
    *   **Significant update (11/25/2025, 4:04:34 PM):** This entry shows a substantial refactoring.
        *   **New Error Constants:** `ErrFailedToEncrypt`, `ErrFailedToUnlock`, `ErrFailedToRestore` were explicitly added.
        *   **`EncryptionResult` Refinement:** The `FailedToRecover` field and its associated logic in `Failed()` and `BuildError()` were removed, suggesting a change in how recovery failures are tracked or handled.
        *   **Dependency Reduction:** The `common` package import was removed from this file.
        *   **Hardcoded Path:** The `tempDir` in `EncryptTargetDirs` was changed from using `common.MigrationDirPath` to a hardcoded string `"/opt/128technology/integrity/.migration-store/"`.
        *   **Refined Error Handling:** The error handling after calling `encryptTargetDir` in `EncryptTargetDirs` was re-structured using a `switch` statement, leveraging the newly defined specific error types for clearer failure identification.
        *   **Function Signature Change:** The `encryptTargetDir` function's signature was updated to explicitly accept `tempDir`, and the internal logic for `recoveryDir` and `migrateToRecoveryDir` was removed, indicating a streamlining or externalization of recovery path management for individual target directories during encryption.
        *   **Cleanup:** A new step was added to `EncryptTargetDirs` to remove the temporary `tempDir` upon successful encryption of a target.

**Timestamps of Significant Changes:**

*   **11/21/2025, 2:26:50 PM**: Initial definition of common directory paths.
*   **11/21/2025, 2:27:15 PM**: Initial implementation of the core Integrity Handler logic.
*   **11/21/2025, 4:00:45 PM**: Initial implementation of the `main` application entry point.
*   **11/21/2025, 4:02:40 PM**: Minor comment update in `common/directories.go`.
*   **11/21/2025, 4:11:30 PM**: Initial implementation of `fscrypt` wrappers and encryption orchestration.
*   **11/25/2025, 4:04:34 PM**: Major refactoring and enhancement of `fscrypt.go`, including error handling, dependency changes, and simplification of recovery tracking within `EncryptionResult`.

**Patterns or Recurring Elements in the Content:**

*   **Copyright Notice:** All files consistently start with `// Copyright (c) Juniper Networks, Inc. 2025. All rights reserved.`.
*   **Logging:** The `github.com/Juniper-SSN/ssr/go/src/log` package is extensively used across all files for debugging, informational messages, warnings, and error reporting (`log.Debug`, `log.Info`, `log.Warn`, `log.Errorf`).
*   **Error Handling:** Go's error wrapping (`fmt.Errorf("...: %w", ...)`) is consistently used to provide context to errors. The `errors.Is` and `errors.As` functions are employed for structured error checking.
*   **`context.Context`:** A `context.Context` object is passed through many function calls, enabling cancellation or timeout signals throughout the application's operations.
*   **`afero.Fs`:** The `github.com/spf13/afero` package is used for abstracting file system operations, allowing for easier testing and potentially different file system implementations.
*   **Integrity and Security Focus:** The repeated mentions of TPM, FEMK (File Encryption Master Key), secure containers, and fscrypt underscore the application's primary goal of ensuring system and data integrity through encryption.
*   **Idempotency Comments:** Functions like `enableIntegrity` and `EncryptTargetDirs` are explicitly marked with comments indicating they "must be idempotent," highlighting a design goal for reliable operation even if executed multiple times.

## 1:26:50 AM
The provided log details changes across several Go files related to an "Integrity Handler" application.

### File-Specific Updates:

*   **`/Users/cnesbitt/shared/ssr/go/bin/IntegrityHandler/common/directories.go`**
    *   **11/21/2025, 2:26:50 PM**: This file was initially defined, establishing a set of constant string paths critical to the Integrity Handler's operation. These include `BootDirPath`, `EncryptedKeyPath` (for the FEMK - File Encryption Master Key), `MigrationDirPath`, `RecoveryDirPath`, and `ManifestDirPath`, all pointing to locations within `/boot/integrity` or `/opt/128technology/integrity/`.
    *   **11/21/2025, 4:02:40 PM**: A minor update occurred, changing the package-level comment to better reflect its purpose as holding common globals for the Integrity Handler, but the constants themselves remained unchanged.

*   **`/Users/cnesbitt/shared/ssr/go/bin/IntegrityHandler/integrity.go`**
    *   **11/21/2025, 2:27:15 PM** (and subsequent identical logs at 2:27:22 PM, 2:28:49 PM, 2:40:35 PM): This file contains the core logic of the Integrity Handler. It imports various packages for context management, error handling, filesystem operations (`afero`), `fscrypt` integration, TPM interaction, secure container for keys (`vault`), and logging. Key functions include:
        *   `verifyAndInitializeEnvironment`: Checks system requirements like root privileges, kernel version (>= 5.4), filesystem encryption support (`fscrypt/metadata`), and TPM initialization.
        *   `enableIntegrity`: Orchestrates the encryption process by ensuring necessary directories exist, creating/resolving the FEMK, setting up `fscrypt` on the mount, and encrypting target directories. It is designed to be idempotent.
        *   `unlockEncryptedDirs`: Handles unlocking previously encrypted directories.
        *   `getFsKey`: Securely retrieves and stores the filesystem key, wiping the plaintext key after use.
        *   `ensureDirectoriesExist`: Creates and sets permissions for various operational and recovery directories, also attempting to clean up the migration directory.
        *   `handleRecoveryDirectoryWarnings`: Logs warnings if data is found in the recovery directory, suggesting manual intervention.

*   **`/Users/cnesbitt/shared/ssr/go/bin/IntegrityHandler/main.go`**
    *   **11/21/2025, 4:00:45 PM**: This file defines the entry point (`main` function) for the Integrity Handler application. It introduces custom `ExitCode` constants (Success, Failure, Incompatible, Compromised) for structured exits. It parses a `mount` path command-line argument and orchestrates the application's main flow, calling `verifyAndInitializeEnvironment`, `handleRecoveryDirectoryWarnings`, `enableIntegrity`, and `unlockEncryptedDirs` from `integrity.go`. It also embeds a version string.

*   **`/Users/cnesbitt/shared/ssr/go/bin/IntegrityHandler/fscrypt/fscrypt.go`**
    *   **11/21/2025, 4:11:30 PM**: This initial version provided wrappers for `fscrypt` operations. It defined several specific error types (e.g., `ErrTargetAlreadyEncrypted`, `ErrFailedToRelocate`), a `protectorName` constant ("FEMK"), and a `SetupOnMount` function to configure `fscrypt` globally and per-filesystem. The `EncryptionResult` struct was introduced to detail the outcomes of encryption attempts. The `EncryptTargetDirs` function managed the encryption process, which involved relocating content to a temporary directory (`common.MigrationDirPath`), recreating and encrypting the target directory, and handling potential recovery (`common.RecoveryDirPath`).
    *   **11/25/2025, 4:04:34 PM**: A significant refactoring occurred in this file:
        *   The `common` package import was removed, leading to a hardcoded path string (`"/opt/128technology/integrity/.migration-store/"`) for temporary directories within `EncryptTargetDirs`.
        *   New specific error types (`ErrFailedToEncrypt`, `ErrFailedToUnlock`, `ErrFailedToRestore`) were added.
        *   The `EncryptionResult` struct was modified by removing the `FailedToRecover` field, and corresponding adjustments were made to its `Failed()` and `BuildError()` methods.
        *   The `encryptTargetDir` function signature was updated to accept the temporary directory path as an argument.
        *   The error handling logic within `EncryptTargetDirs` was enhanced with a `switch` statement for more granular reporting of encryption failures, and the explicit recovery directory handling within the `encryptTargetDir` snippet was removed, likely indicating a change in its management or scope.

### Timestamps of Significant Changes:

*   **11/21/2025, 2:26:50 PM**: Creation of core directory path constants (`directories.go`).
*   **11/21/2025, 2:27:15 PM**: Initial implementation of the main integrity handling logic (`integrity.go`).
*   **11/21/2025, 4:00:45 PM**: Introduction of the application's entry point and overall control flow (`main.go`).
*   **11/21/2025, 4:11:30 PM**: Initial integration and wrapper functions for `fscrypt` (`fscrypt.go`).
*   **11/25/2025, 4:04:34 PM**: Substantial refactoring in `fscrypt.go`, specifically concerning dependency removal (`common` package) and refined error handling for encryption operations.

### Patterns and Recurring Elements:

*   **Juniper Networks Copyright**: All files consistently include a copyright notice for Juniper Networks, Inc. dated 2025.
*   **Extensive Logging**: The `log` package is heavily utilized across all files for debugging, informational messages, warnings, and error reporting.
*   **Robust Error Handling**: Go's error wrapping (`fmt.Errorf("%w: %w", ...)`) and error joining (`errors.Join`) are frequently used, particularly to propagate and categorize failures related to integrity compromises or operational issues.
*   **Filesystem Abstraction**: The `github.com/spf13/afero` library is used for abstracting filesystem operations, allowing for more testable and flexible code regarding file and directory manipulation.
*   **Security Focus**: The overall codebase is dedicated to an "Integrity Handler", emphasizing system integrity, encryption via `fscrypt`, TPM (Trusted Platform Module) integration for key management, and secure handling of the File Encryption Master Key (FEMK) using a `SecureContainer`.
*   **Path Management**: Specific directory paths (e.g., `/boot/integrity`, `/opt/128technology/integrity/`) are central to the application's operation, often defined as constants and used for storing critical files, migration data, or recovery information.
*   **Idempotency as a Goal**: Several functions, such as `enableIntegrity` and `EncryptTargetDirs`, are explicitly designed or noted as needing to be idempotent, indicating a focus on reliable and repeatable operations.
*   **`// TODO:` Comments**: The code contains numerous `// TODO:` comments indicating planned future enhancements, refactoring, or areas requiring further consideration, such as improved shredding, context plumbing, and manifest processing.

## 2:26:52 AM
The provided log details changes across several Go files related to an "Integrity Handler" application, primarily focusing on filesystem encryption and security.

### File-Specific Updates:

*   **`/Users/cnesbitt/shared/ssr/go/bin/IntegrityHandler/common/directories.go`**
    *   **11/21/2025, 2:26:50 PM**: This file was initially defined, establishing constants for critical directory paths used by the Integrity Handler. These paths include `/boot/integrity` (for handler files), `/boot/integrity/femk.enc` (for the encrypted File Encryption Master Key), `/opt/128technology/integrity/.migration-store` (for migration data), `/opt/128technology/integrity/migration-recovery` (for recovery data), and `/opt/128technology/integrity/manifest.d` (for manifest files).
    *   **11/21/2025, 4:02:40 PM**: A minor update occurred, changing the package comment to "Package common contains common globals used throughout Integrity Handler," refining its description without altering the defined constants or their values.

*   **`/Users/cnesbitt/shared/ssr/go/bin/IntegrityHandler/integrity.go`**
    *   **11/21/2025, 2:27:15 PM - 11/21/2025, 2:40:35 PM**: Across these timestamps, the content of `integrity.go` remained identical. This file contains the core business logic of the Integrity Handler. Key functions include `verifyAndInitializeEnvironment` (which checks for root privileges, kernel version, filesystem encryption support, `fscrypt` utility, and TPM initialization), `enableIntegrity` (which sets up directories, manages the FEMK, and orchestrates directory encryption), `unlockEncryptedDirs` (for decrypting and unlocking directories), `getFsKey` (for securely managing the FEMK), `ensureDirectoriesExist` (for creating and cleaning application-specific directories), and `handleRecoveryDirectoryWarnings` (for checking and reporting on the recovery directory).

*   **`/Users/cnesbitt/shared/ssr/go/bin/IntegrityHandler/main.go`**
    *   **11/21/2025, 4:00:45 PM**: This file was introduced, defining the main entry point (`func main`) for the Integrity Handler application. It establishes `ExitCode` constants (Success, Failure, Incompatible, Compromised) for standardized process return values. It embeds the application version, parses a `mount` path argument, and orchestrates the main application flow by calling functions from other packages (like `handleRecoveryDirectoryWarnings`, `verifyAndInitializeEnvironment`, `enableIntegrity`, and `unlockEncryptedDirs`). It includes error handling to map internal application failures to specific exit codes, notably `ExitCompromised` for integrity violations.

*   **`/Users/cnesbitt/shared/ssr/go/bin/IntegrityHandler/fscrypt/fscrypt.go`**
    *   **11/21/2025, 4:11:30 PM**: The initial implementation of `fscrypt.go` provided high-level wrappers for `fscrypt` operations. It defined various error constants related to encryption and file system operations, specified "FEMK" as the `protectorName`, and implemented `SetupOnMount` for `fscrypt` initialization. The `EncryptionResult` struct was introduced to track the outcomes of encryption attempts. Functions like `EncryptTargetDirs` and `encryptTargetDir` outlined the process of moving directory contents to a temporary location, encrypting the empty target directory, and then moving contents back. This version explicitly used `common.MigrationDirPath` and `common.RecoveryDirPath` for constructing temporary directory paths.
    *   **11/25/2025, 4:04:34 PM**: A significant refactoring occurred. The import of the `common` package was removed. Correspondingly, directory path constructions (like `tempDir`) were changed to use hardcoded strings instead of the `common` package constants. New specific error constants (`ErrFailedToEncrypt`, `ErrFailedToUnlock`, `ErrFailedToRestore`) were added. The `EncryptionResult` struct was updated, removing `FailedToRecover`. The `EncryptTargetDirs` function was enhanced with a `switch` statement for more granular error handling upon return from `encryptTargetDir`, and the explicit `migrateToRecoveryDir` call was removed from `encryptTargetDir`, suggesting a revised approach to recovery or error flow management.

### Timestamps of Significant Changes:

*   **11/21/2025, 2:26:50 PM**: Initial structural definition of common directory paths.
*   **11/21/2025, 2:27:15 PM**: Initial comprehensive implementation of Integrity Handler's core functions.
*   **11/21/2025, 4:00:45 PM**: Creation of `main.go`, establishing the application's entry point and overall operational flow.
*   **11/21/2025, 4:11:30 PM**: Initial implementation of `fscrypt` integration for file system encryption.
*   **11/25/2025, 4:04:34 PM**: Major refactoring in `fscrypt.go`, indicating a design change in how migration paths are handled and how `fscrypt` errors are processed, including the removal of the `common` package dependency for path constants.

### Patterns or Recurring Elements:

*   **Standard Copyright**: All Go files consistently include the copyright notice "Copyright (c) Juniper Networks, Inc. 2025. All rights reserved."
*   **Security and Integrity Focus**: The entire codebase is dedicated to ensuring "Config Integrity" through encryption, secure key management (FEMK, vault), and hardware-backed trust (TPM).
*   **Robust Error Handling**: There is a consistent pattern of defining custom error types (`errors.New`, `fmt.Errorf("%w: %w")`), joining errors (`errors.Join`), and careful error propagation to provide detailed failure information and influence application exit codes.
*   **Directory Management**: A recurring theme is the creation, cleanup, and management of specific directories (`/boot/integrity`, `/opt/128technology/integrity/.migration-store`, etc.) crucial for the application's operation, migration, and recovery.
*   **Idempotency Requirement**: Key functions like `enableIntegrity` and `EncryptTargetDirs` are explicitly designed or noted to be idempotent, ensuring that repeated calls do not lead to unintended side effects.
*   **Temporal Clustering**: Many significant changes (initial definitions of directories, core logic, `main` function, initial `fscrypt` implementation) occurred on 11/21/2025, suggesting a concentrated period of foundational development. A distinct, more functional refactoring occurred a few days later on 11/25/2025.

## 3:26:52 AM
The log details changes across several Go files related to an "Integrity Handler" application, primarily focused on filesystem encryption using `fscrypt` and TPM integration.

### File-Specific Updates:

*   **`/Users/cnesbitt/shared/ssr/go/bin/IntegrityHandler/common/directories.go`**
    *   **Initial State (11/21/2025, 2:26:50 PM):** This file defines constant string paths for various Integrity Handler directories, including `BootDirPath`, `EncryptedKeyPath` (for `femk.enc`), `MigrationDirPath`, `RecoveryDirPath`, and `ManifestDirPath`. These paths are crucial for the application's operation, specifying locations for encrypted keys, migration data, recovery data, and integrity manifests.
    *   **Update (11/21/2025, 4:02:40 PM):** A minor change occurred in the package-level comment. It was updated from a more specific description about a "secure container to hold our key at runtime" to a broader statement: "Package common contains common globals used throughout Integrity Handler." The defined path constants remained unchanged.

*   **`/Users/cnesbitt/shared/ssr/go/bin/IntegrityHandler/integrity.go`**
    *   **Initial State (11/21/2025, 2:27:15 PM):** This file contains the core logic for the Integrity Handler. It imports packages for `fscrypt`, `tpm`, `vault`, and common utilities. Key functions include:
        *   `verifyAndInitializeEnvironment`: Checks system prerequisites like root privileges, kernel version (>= 5.4), filesystem encryption support, `fscrypt` command availability, and TPM initialization.
        *   `enableIntegrity`: An idempotent function responsible for ensuring necessary directories exist, creating/resolving the File Encryption Master Key (FEMK), setting up `fscrypt` on the mount, and encrypting target directories.
        *   `unlockEncryptedDirs`: Handles unlocking previously encrypted directories.
        *   `getFsKey`: A lazy-loading function for retrieving the filesystem key, including decryption of the FEMK and securely storing the plain key, with a safeguard to wipe the original key slice.
        *   `ensureDirectoriesExist`: Creates and optionally cleans required directories with specific permissions.
        *   `handleRecoveryDirectoryWarnings`: Logs warnings if content is found in the recovery directory, indicating potential issues requiring manual intervention.
    *   **Update (11/21/2025, 2:28:49 PM):** A minor functional change occurred in `handleRecoveryDirectoryWarnings`. The explicit check `afero.Exists` and the subsequent early return `if !exists { return }` were removed. This means the function will now attempt to read the `RecoveryDirPath` directly, rather than first verifying its existence, possibly simplifying the flow or assuming the directory should always exist.
    *   **Note:** Two entries for this file at 2:27:15 PM and 2:27:22 PM are identical. Another entry at 2:40:35 PM is also identical to the 2:28:49 PM version, indicating no further changes after the one at 2:28:49 PM.

*   **`/Users/cnesbitt/shared/ssr/go/bin/IntegrityHandler/main.go`**
    *   **New File (11/21/2025, 4:00:45 PM):** This file introduces the `main` application entry point. It defines custom `ExitCode` constants (`ExitSuccess`, `ExitFailure`, `ExitIncompatible`, `ExitCompromised`) to align with systemd service return codes. It embeds the application version using `//go:embed`. The `main` function sets the log level, parses a `mount` path command-line argument, and orchestrates the primary application flow through the `run` function. The `run` function handles version logging, environment initialization, calls to `enableIntegrity` and `unlockEncryptedDirs`, and manages error propagation with specific `ExitCode` returns for different failure scenarios, including integrity compromises.

*   **`/Users/cnesbitt/shared/ssr/go/bin/IntegrityHandler/fscrypt/fscrypt.go`**
    *   **Initial State (11/21/2025, 4:11:30 PM):** This file provides high-level wrappers for `fscrypt` operations. It defines numerous error constants related to encryption and directory states (e.g., `ErrTargetAlreadyEncrypted`, `ErrFailedToRelocate`, `ErrFscryptNotSupportedOnMount`). It includes:
        *   `SetupOnMount`: Performs global and filesystem-specific `fscrypt` setup, designed to be idempotent.
        *   `EncryptionResult`: A struct to track the detailed outcome of encryption attempts, including `Success`, `AlreadyEncrypted`, and various failure categories like `FailedToRelocate`, `FailedToEncrypt`, `FailedToUnlock`, `FailedToRestore`, and `FailedToRecover`.
        *   `EncryptTargetDirs`: Iterates through target directories, encrypting them if not already encrypted by calling `encryptTargetDir`.
        *   `encryptTargetDir`: Contains the core logic for vacating a target directory, recreating it empty, encrypting it, and then planning to move contents back. It notes an incomplete error handling for moving contents back to a recovery directory in case of encryption failure.
    *   **Major Update (11/25/2025, 4:04:34 PM):** A significant refactor of error handling and result reporting within the `fscrypt` package.
        *   **New Error Constants:** `ErrFailedToEncrypt`, `ErrFailedToUnlock`, and `ErrFailedToRestore` were explicitly introduced to provide more specific error reporting.
        *   **`EncryptionResult` Changes:** The `FailedToRecover` field was removed from the `EncryptionResult` struct, and its corresponding logic was removed from `newEncryptionResult`, `Failed()`, and `BuildError()` methods. This indicates a shift in how recovery failures are managed or reported.
        *   **`EncryptTargetDirs` Refactor:** The `common` package import was removed, suggesting that directory paths (like `MigrationDirPath`) are now expected to be managed by the caller or passed as arguments. The function now uses a `switch` statement to handle specific errors returned by `encryptTargetDir`, allowing for more granular post-encryption failure handling. Upon successful processing, it explicitly calls `fs.RemoveAll(tempDir)` for cleanup.
        *   **`encryptTargetDir` Simplification:** This function no longer manages the `recoveryDir` directly or its associated recovery logic. The `tempDir` path is now passed as an argument instead of being constructed internally, indicating that the calling `EncryptTargetDirs` function is now responsible for defining and passing these temporary paths. Comments related to conditional error returns for moving contents back to a recovery directory were removed, suggesting a streamlined error handling contract where `encryptTargetDir` focuses solely on the encryption step and reports failures, while the caller handles the broader recovery/cleanup strategy.

### Timestamps of Significant Changes:

*   **11/21/2025, 2:26:50 PM**: Initial definition of common directory paths.
*   **11/21/2025, 2:27:15 PM**: Initial implementation of the core Integrity Handler logic.
*   **11/21/2025, 2:28:49 PM**: Minor functional adjustment in `integrity.go`'s recovery warning handling.
*   **11/21/2025, 4:00:45 PM**: Introduction of `main.go`, establishing the application's entry point and overall flow.
*   **11/21/2025, 4:02:40 PM**: Minor comment update in `directories.go`.
*   **11/21/2025, 4:11:30 PM**: Initial implementation of `fscrypt` wrappers.
*   **11/25/2025, 4:04:34 PM**: Major refactor of error handling and recovery logic within `fscrypt/fscrypt.go`, notably occurring several days after other changes.

### Patterns and Recurring Elements:

*   **Copyright Notice**: All files include the standard `// Copyright (c) Juniper Networks, Inc. 2025. All rights reserved.` notice.
*   **Juniper-SSN/ssr Ecosystem**: All import paths and the overall structure indicate this code is part of the `github.com/Juniper-SSN/ssr` project, specifically within an "Integrity Handler" component.
*   **Focus on Integrity and Encryption**: The codebase consistently deals with ensuring system integrity, primarily through filesystem encryption (`fscrypt`), secure key management (`vault`), and hardware security (`tpm`).
*   **Robust Error Handling**: There is extensive use of Go's `errors` package (`errors.New`, `fmt.Errorf`, `errors.Is`, `errors.As`, `errors.Join`) for detailed and classified error reporting, crucial for a security-focused application.
*   **Directory Management**: Regular creation, cleaning, and monitoring of specific operational and recovery directories (`/boot/integrity`, `/opt/128technology/integrity/.migration-store`, `/opt/128technology/integrity/migration-recovery`, `/opt/128technology/integrity/manifest.d`).
*   **Idempotency**: The need for idempotency is explicitly mentioned for key functions (`enableIntegrity`, `EncryptTargetDirs`), indicating design for reliability and re-execution without adverse side effects.
*   **Chronological Development**: Most changes occurred on 11/21/2025, with a distinct, later major update to the `fscrypt` error handling on 11/25/2025, suggesting a period of focused development followed by a significant refinement in a specific module.